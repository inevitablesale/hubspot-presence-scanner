# Render deployment configuration for Tech Stack Scanner Pipeline
# Replace placeholder values with your own before deploying

services:
  # Single worker that runs all tasks sequentially
  - type: worker
    name: daily-pipeline-worker
    env: docker
    plan: starter
    dockerfilePath: ./Dockerfile
    autoDeploy: true
    envVars:
      # Supabase Configuration
      - key: SUPABASE_URL
        sync: false
      - key: SUPABASE_SERVICE_KEY
        sync: false
      - key: SUPABASE_TABLE
        value: tech_scans
      - key: SUPABASE_DOMAIN_TABLE
        value: domains_seen
      - key: SUPABASE_CATEGORIES_TABLE
        value: categories_used
      # Apify Configuration
      - key: APIFY_TOKEN
        sync: false
      - key: APIFY_ACTOR
        value: compass/crawler-google-places
      - key: SCANNER_MAX_EMAIL_PAGES
        value: "10"
      - key: SCANNER_DISABLE_EMAILS
        value: "false"
      - key: CATEGORIES_FILE
        value: config/categories-250.json
      # Outreach Configuration
      - key: OUTREACH_TABLE
        value: tech_scans
      # SMTP_ACCOUNTS_JSON format: {"inboxes":[{"email":"...","smtp_host":"...","smtp_port":587,"smtp_user":"...","smtp_password":"..."}]}
      - key: SMTP_ACCOUNTS_JSON
        sync: false
      - key: OUTREACH_DAILY_LIMIT
        value: "500"
      - key: OUTREACH_PER_INBOX_LIMIT
        value: "50"
      - key: SMTP_SEND_DELAY_SECONDS
        value: "4"
      # Calendly Configuration (optional - leave CALENDLY_API_TOKEN empty to skip sync)
      - key: CALENDLY_API_TOKEN
        sync: false
      - key: CALENDLY_SYNC_TABLE
        value: tech_scans
      - key: CALENDLY_BOOKINGS_TABLE
        value: calendly_bookings
      - key: CALENDLY_LOOKBACK_DAYS
        value: "7"
      # OpenAI Configuration (optional - for email rewriting)
      - key: OPENAI_API_KEY
        sync: false
      - key: OPENAI_MODEL
        value: gpt-4.1-mini
      - key: OPENAI_EMAIL_TEMPERATURE
        value: "0.4"
      - key: OPENAI_EMAIL_MAX_TOKENS
        value: "400"
      # Company Profile Configuration (for email templates)
      - key: COMPANY_NAME
        sync: false
      - key: COMPANY_LOCATION
        sync: false
      - key: COMPANY_HOURLY_RATE
        sync: false
      - key: COMPANY_GITHUB
        sync: false
      - key: COMPANY_CALENDLY
        sync: false
      - key: PERSONA_MAP_JSON
        sync: false

cronJobs:
  # Runs at 6:00 AM UTC daily - executes all workers sequentially:
  # 1. Pipeline Worker (scan domains for tech)
  # 2. Outreach Worker (send emails)
  # 3. Calendly Sync (track bookings)
  - name: daily-pipeline
    schedule: "0 6 * * *"
    service: daily-pipeline-worker
    command: "python daily_worker.py"
