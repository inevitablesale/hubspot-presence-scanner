# Render deployment configuration for Tech Stack Scanner Pipeline
# Replace placeholder values with your own before deploying

services:
  - type: worker
    name: tech-scan-pipeline-worker
    env: docker
    plan: starter
    dockerfilePath: ./Dockerfile
    autoDeploy: true
    envVars:
      # Replace with your Supabase project URL
      - key: SUPABASE_URL
        sync: false
      - key: SUPABASE_SERVICE_KEY
        sync: false
      - key: SUPABASE_TABLE
        value: tech_scans
      - key: SUPABASE_DOMAIN_TABLE
        value: domains_seen
      - key: APIFY_TOKEN
        sync: false
      - key: APIFY_ACTOR
        value: compass/crawler-google-places
      - key: SCANNER_MAX_EMAIL_PAGES
        value: "10"
      - key: SCANNER_DISABLE_EMAILS
        value: "false"
      - key: CATEGORIES_FILE
        value: config/categories-250.json

  - type: worker
    name: outreach-worker
    env: docker
    plan: starter
    dockerfilePath: ./Dockerfile
    autoDeploy: true
    envVars:
      # Replace with your Supabase project URL
      - key: SUPABASE_URL
        sync: false
      - key: SUPABASE_SERVICE_KEY
        sync: false
      - key: OUTREACH_TABLE
        value: tech_scans
      # SMTP_ACCOUNTS_JSON format: {"inboxes":[{"email":"...","smtp_host":"...","smtp_port":587,"smtp_user":"...","smtp_password":"..."}]}
      - key: SMTP_ACCOUNTS_JSON
        sync: false
      - key: OUTREACH_DAILY_LIMIT
        value: "500"
      - key: OUTREACH_PER_INBOX_LIMIT
        value: "50"
      - key: SMTP_SEND_DELAY_SECONDS
        value: "4"

cronJobs:
  - name: daily-tech-domain-scan
    schedule: "0 6 * * *"
    service: tech-scan-pipeline-worker
    command: "python pipeline_worker.py"

  - name: daily-outreach-send
    schedule: "0 14 * * *"
    service: outreach-worker
    command: "python outreach_worker.py"
